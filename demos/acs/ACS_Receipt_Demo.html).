<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>TruthSeal — Local ACS + Receipt Demo (Offline)</title>
  <link rel="stylesheet" href="/assets/ts-theme.css">
</head>
<body>
  <div class="wrap">
    <h1 class="brand">TruthSeal — Local ACS + Receipt Demo (Offline)</h1>
    <p class="muted">Runs entirely in the browser. No network. Use this to show a real <em>Aim Coherence Score</em> and then save a receipt JSON locally.</p>

    <div class="panel" style="margin-top:18px">
      <div class="grid">
        <div>
          <label>Purity (no contradiction) — range [0…1]</label>
          <input id="purity" type="number" min="0" max="1" step="0.01" value="1.00">
        </div>
        <div>
          <label>Temporal drift — range [0…1]</label>
          <input id="drift" type="number" min="0" max="1" step="0.01" value="0.00">
        </div>
        <div>
          <label>Ethical irreversibility (LEI)</label>
          <select id="lei">
            <option value="ENFORCED" selected>ENFORCED</option>
            <option value="DISABLED">DISABLED</option>
          </select>
        </div>
        <div>
          <label>Secure attestation (trusted boot)</label>
          <select id="attest">
            <option value="trusted" selected>trusted</option>
            <option value="untrusted">untrusted</option>
          </select>
        </div>
      </div>

      <p style="margin:16px 0">
        <span class="status" id="status">STATUS: COHERENT</span>
        <span class="status" id="att-status">ATTESTATION: TRUSTED</span>
      </p>

      <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:6px">
        <button class="btn" onclick="gen()">Generate Receipt</button>
        <button class="btn" onclick="download()">Download JSON</button>
        <button class="btn" onclick="show()">Show JSON</button>
      </div>
    </div>

    <pre id="json" style="margin-top:16px; background:#071524; border:1px solid var(--line); border-radius:12px; padding:12px; overflow:auto; display:none;">{}</pre>
  </div>

<script>
function acs() {
  const p = clamp(parseFloat(el('purity').value),0,1);
  const d = clamp(parseFloat(el('drift').value),0,1);
  const leiEnforced = el('lei').value === 'ENFORCED';
  const attTrusted  = el('attest').value === 'trusted';
  const acs = (p * (1 - d) * (leiEnforced ? 1 : 0.2)).toFixed(4);
  el('status').textContent = 'STATUS: ' + (acs >= 0.70 ? 'COHERENT' : 'INCOHERENT');
  el('att-status').textContent = 'ATTESTATION: ' + (attTrusted ? 'TRUSTED' : 'UNTRUSTED');
  return {acs, p, d, leiEnforced, attTrusted};
}

function gen(){
  const {acs, p, d, leiEnforced, attTrusted} = acs();
  const payload = {
    action_id: cryptoRandom(),
    actor: {model_id: "tqc/agent:v1", hw_id: "tqc/blackwell:ts"},
    lei_gate_state: leiEnforced ? "ENFORCED" : "DISABLED",
    acs_value: parseFloat(acs),
    decision: (acs >= 0.70 ? "approve" : "halt"),
    timestamp_utc: new Date().toISOString(),
    pqc_signature: {"alg":"CRYSTALS-Dilithium2","sig":"demo-only"},
    attestation: attTrusted ? "trusted" : "untrusted",
    purity: p, drift: d
  };
  currentJSON = payload;
  el('json').style.display='block';
  el('json').textContent = JSON.stringify(payload, null, 2);
}

function download(){
  if(!currentJSON) gen();
  const blob = new Blob([JSON.stringify(currentJSON,null,2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'truthseal_acs_receipt.json';
  document.body.appendChild(a); a.click(); a.remove();
}

function show(){ if(!currentJSON) gen(); el('json').style.display='block'; }
function el(id){return document.getElementById(id)}
function clamp(v,min,max){v=isNaN(v)?0:v; return Math.max(min,Math.min(max,v))}
function cryptoRandom(){return (self.crypto&&crypto.randomUUID)?crypto.randomUUID():String(Date.now())}
let currentJSON=null;
</script>
</body>
</html>
